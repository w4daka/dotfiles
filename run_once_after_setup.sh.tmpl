#!/bin/bash
# ================================================================= #
# ğŸ› ï¸  Ultimate Environment Setup Script
# Zsh, Neovim, mise, Sheldon, Starship, Flatpak & Development Tools
# ================================================================= #
set -euo pipefail

echo "--- ğŸ“¦ 1. ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (apt) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
sudo apt update
sudo apt install -y \
    zsh i3 rofi make unzip gcc git curl flatpak fcitx5 \
    libxkbcommon0 libc6 build-essential pkg-config libssl-dev

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæº–å‚™
mkdir -p "$HOME/.local/bin"
export PATH="$HOME/.local/bin:$PATH"

echo "--- ğŸ’¤ 2. Neovim (AppImage) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
curl -LO https://github.com/neovim/neovim/releases/latest/download/nvim-linux-x86_64.appimage
chmod u+x nvim-linux-x86_64.appimage
mv nvim-linux-x86_64.appimage "$HOME/.local/bin/nvim"

echo "--- ğŸš 3. Sheldon ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
curl --proto '=https' -fLsS https://rossmacarthur.github.io/install/crate.sh \
    | bash -s -- --repo rossmacarthur/sheldon --to ~/.local/bin

echo "--- âœ¨ 4. Starship ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
curl -sS https://starship.rs/install.sh | sh -s -- --yes --bin-dir "$HOME/.local/bin"

echo "--- ğŸŒ 5. Flatpak ã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
sudo flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo
flatpak install -y flathub com.google.Chrome org.mozilla.firefox net.ankiweb.Anki

echo "--- ğŸ› ï¸  6. mise ã®å°å…¥ã¨ãƒ„ãƒ¼ãƒ«ä¸€æ‹¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
# mise ã®å…¬å¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
curl https://mise.run/bash | sh

# é‡è¦ï¼šç¾åœ¨ã® Bash ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ mise ã‚’å³åº§ã«æœ‰åŠ¹åŒ–ã™ã‚‹
export MISE_DATA_DIR="$HOME/.local/share/mise"
export PATH="$HOME/.local/bin:$MISE_DATA_DIR/bin:$MISE_DATA_DIR/shims:$PATH"
eval "$($HOME/.local/bin/mise activate bash)"

# ã™ã§ã« chezmoi ã§ ~/.config/mise/config.toml ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹å‰æã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# ã‚‚ã—è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯ã€ã“ã®ã‚³ãƒãƒ³ãƒ‰ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹ã‹ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚æ³¨æ„
if [ -f "$HOME/.config/mise/config.toml" ]; then
    mise install -y
else
    echo "âš ï¸  ~/.config/mise/config.toml ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æ‰‹å‹•ã§ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚"
    # æœ€å°é™ã®Nodeã ã‘ã§ã‚‚å…¥ã‚Œã¦ãŠãå ´åˆ: mise use --global node@lts
fi

echo "--- ğŸ“¦ 7. Node.js ãƒ„ãƒ¼ãƒ« (Typescript, yarn) ---"
# mise ã§å…¥ã‚ŒãŸ node/npm ã‚’ç¢ºå®Ÿã«å‚ç…§ã•ã›ã‚‹ãŸã‚ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
mise reshim
npm install -g typescript yarn

echo "--- ğŸ”„ 8. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ã‚§ãƒ«ã‚’ Zsh ã¸å¤‰æ›´ ---"
if [ "$SHELL" != "$(which zsh)" ]; then
    echo "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ã‚§ãƒ«ã‚’ Zsh ã«å¤‰æ›´ã—ã¦ãã ã•ã„..."
    sudo chsh -s "$(which zsh)" "$USER"
fi

echo "--- ğŸ‰ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼ ---"
echo "è¨­å®šã‚’å®Œå…¨ã«åæ˜ ã•ã›ã‚‹ãŸã‚ã€PCã‚’å†èµ·å‹•ã™ã‚‹ã‹ã€ä¸€åº¦ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ãã ã•ã„ã€‚"
echo "å†èµ·å‹•å¾Œã€Zshä¸Šã§ 'nvim' ã‚„ 'lazygit' ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
