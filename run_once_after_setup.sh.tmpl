#!/bin/bash
# ================================================================= #
# ğŸš€ Ultimate Setup Script (Updated: Nerd Fonts Included)
# ================================================================= #
set -euo pipefail

echo "--- ğŸ“¦ 1. ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (apt) ---"
sudo apt update
sudo apt install -y \
    zsh i3 rofi make unzip gcc git curl flatpak fcitx5 \
    libxkbcommon0 libc6 build-essential pkg-config libssl-dev fontconfig

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæº–å‚™
mkdir -p "$HOME/.local/bin"
mkdir -p "$HOME/.local/share/fonts"
export PATH="$HOME/.local/bin:$PATH"

echo "---  font 2. Nerd Fonts (JetBrainsMono) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
# JetBrainsMono Nerd Font ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å±•é–‹
FONT_URL="https://github.com/ryanoasis/nerd-fonts/releases/latest/download/JetBrainsMono.zip"
curl -fLo "/tmp/JetBrainsMono.zip" "$FONT_URL"
unzip -o "/tmp/JetBrainsMono.zip" -d "$HOME/.local/share/fonts/"
fc-cache -f # ãƒ•ã‚©ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°

echo "--- ğŸ’¤ 3. Neovim (AppImage) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
curl -LO https://github.com/neovim/neovim/releases/latest/download/nvim-linux-x86_64.appimage
chmod u+x nvim-linux-x86_64.appimage
mv nvim-linux-x86_64.appimage "$HOME/.local/bin/nvim"

echo "--- ğŸš 4. Sheldon ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
curl --proto '=https' -fLsS https://rossmacarthur.github.io/install/crate.sh \
    | bash -s -- --repo rossmacarthur/sheldon --to ~/.local/bin

echo "--- âœ¨ 5. Starship ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
curl -sS https://starship.rs/install.sh | sh -s -- --yes --bin-dir "$HOME/.local/bin"

echo "--- ğŸŒ 6. Flatpak ã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
sudo flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo
flatpak install -y flathub com.google.Chrome org.mozilla.firefox net.ankiweb.Anki

echo "--- ğŸ› ï¸  7. mise ã®å°å…¥ã¨ãƒ„ãƒ¼ãƒ«ä¸€æ‹¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---"
curl https://mise.run/bash | sh
export MISE_DATA_DIR="$HOME/.local/share/mise"
export PATH="$HOME/.local/bin:$MISE_DATA_DIR/bin:$MISE_DATA_DIR/shims:$PATH"
eval "$($HOME/.local/bin/mise activate bash)"

# mise.toml ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹å‰æã§ãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
if [ -f "$HOME/.config/mise/config.toml" ]; then
    mise install -y
else
    echo "âš ï¸  mise config not found, skipping tool installation."
fi

echo "--- ğŸ“¦ 8. Node.js ãƒ„ãƒ¼ãƒ« (Typescript, yarn) ---"
mise reshim
npm install -g typescript yarn

echo "--- ğŸ”„ 9. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ã‚§ãƒ«ã‚’ Zsh ã¸å¤‰æ›´ ---"
if [ "$SHELL" != "$(which zsh)" ]; then
    sudo chsh -s "$(which zsh)" "$USER"
fi

echo "âœ… ã™ã¹ã¦å®Œäº†ï¼å†èµ·å‹•ã—ã¦ã€ç«¯æœ«ã®ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã‚’ 'JetBrainsMono Nerd Font' ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚"
